


<body>
    <button>Go</button>
    <pre id="console_say_output"></pre>
    <script src="https://code.jquery.com/jquery-3.7.1.slim.min.js" integrity="sha256-kmHvs0B+OpCW5GVHUNjv9rOmY0IvSIRcf7zGUDTDQM8=" crossorigin="anonymous"></script>
    <script>console.clear()</script>
    <script src="https://unpkg.com/@timkay/say"></script>
    <script>
        window.say = (s, ...v) => {
            const t = JSON.say(s, ...v);
            if (typeof t === 'string') {
                const part = t.split(' ')
                console.elt.innerHTML += `<span title=${part[0]}>${part.slice(1).join(' ')}</span>\n`;
            }
        };
        async function sleep(sec) {
            return new Promise((resolve, reject) => {
                setTimeout(resolve, 1000 * sec)
            })
        }
        async function* gen() {
            await sleep(1)
            yield Promise.resolve(3)
            await sleep(1)
            yield Promise.resolve(42)
        }
        let g_resolve
        async function* read() {
            for (;;) {
                yield new Promise(resolve => {
                    g_resolve = resolve
                })
            }
        }
        $('button').on('click', event => {
            console.log(event)
            g_resolve(event)
        })
        async function main() {
            say `Hello, world!`
            say `1 ${(await gen().next()).value}`
            say `2 ${(await gen().next()).value}`
            await read()
            say `done`
        }
        main()
    </script>
</body>

