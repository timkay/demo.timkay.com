<html>
    <head>
        <title>Demos - timkay</title>
        <link rel="stylesheet" href="style.css" />
    </head>
    <body>
        
<h2>Node.js Version</h2>
<pre style="border: thin solid gray; padding: 10px">
#!/usr/bin/node

function sha512(s) {
    const sha512 = require('crypto').createHash('sha512')
    const data = sha512.update(s, 'utf-8')
    return data.digest('hex')
}

const secretkey = 'Tim was here'
const github = 'This is a test'
const mac = sha512(secretkey + sha512(secretkey + github)).substr(0, 12)

console.log(mac)
</pre>

<h2>Python Version</h2>

<iframe src="https://trinket.io/embed/python3/e2cdc9dbba?start=result" width="100%" height="356" frameborder="0" marginwidth="0" marginheight="0" allowfullscreen></iframe>

<h2>JavaScript in Browser Test</h2>


<p>You can't compute the SupportKey in the browser because it would give up the
secret key. Thus, the SupportKey needs to be computed on the server using node.js.</p>

<p>This JavaScript code is included for testing.</p>

        GitHub Name: <input id="GitHubName" value="This is a test">
        <pre id="console_say_output"></pre>
        <script src="jquery.js"></script>
        <script src="https://unpkg.com/@timkay/say"></script>
        <script src="weedit.js" defer></script>
        <script>
            console.clear()

            // See https://stackoverflow.com/a/55926440/24558, etc.
            function sha512(s) {
              return    crypto.subtle.digest("SHA-512", new TextEncoder("utf-8").encode(s))
                        .then(buf => {
                            return [...new Uint8Array(buf)].map(x => x.toString(16).padStart(2, 0)).join('');
                        });
            }
            
            async function update() {
                const s = $('#GitHubName').val()
                const secretkey = 'Tim was here'
                const mac = (await sha512(secretkey + await sha512(secretkey + s))).substr(0, 12)
                say `  SupportKey = ${mac}  (${s})`
            }

            let timer
            
            function go() {
                if (timer) clearTimeout(timer)
                timer = setTimeout(update, 500)
            }
            
            $('#GitHubName').keyup(go)
            go()
        </script>
    </body>
</html>
