<!DOCTYPE html>
<html>
    <head>
        <title>Slider Demo - timkay</title>
        <link rel="stylesheet" href="style.css" />
        <style>
            html, body {
                margin: 0;
                height: 100%;
                box-sizing: border-box;
                border: thin solid green;
            }
            .slider * {
                pointer-events: none;
            }
            .slider {
                position: relative;
                display: inline-block;
                margin: 20px 0 0 20px;
                width: 50%;
                height: 25px;
                background: white;
            }
            .thumb {
                position: absolute;
                width: 25px;
                height: 25px;
                background: blue;
                border-radius: 50%;
                left: 100px;
            }
            p {
                width: 700px;
            }
        </style>
    </head>
    <body>
        <script src="jquery.js"></script>
        <script src="weedit.js" defer></script>
        <h2>Slider Demo</h2>
        <div class="slider"><div class="thumb"></div></div>
        <p>
            The problem is that, when .slider listens for mousemove events, its child,
            .thumb, gets the events first. The event.offsetX value is measured relative
            to the target, which is either .slider or .thumb. Thus, if you click
            and slide on the middle of slider, .thumb jumps underneath the pointer,
            and suddenly distance is measured from the left edge of .thumb rather
            than .slider. That's why it kept skittering back and forth.
        </p>
        <p>
            Two approaches to fix it: 1) use pointer-events: none to turn off pointer
            events for all children of .slider. There are still a number of issues
            that have to be considered. For example, if I mousedown on .slider but
            mouuseup off .slider, then it doesn't see the mouseup. That's why mouseup
            is attached to body. 2) Stop using offsetX and start upsing
            pageX-(left edge of .slider).
        </p>
        <p>
            Another annoying thing is that, if you grab .thumb and slide off .slider,
            it ignores mousemove until you slide back on. So maybe mousemove should
            be hooked to body, but then you need to stop using offsetX.
        </p>
        <pre></pre>
        <script>
            console.clear();
            function movethumb(x) {
                $('pre').text(`thumb position ${x}`);
                $('.thumb').css({left: x - 12});
            }
            function mousedown(event) {
                console.log(event.type, event.target === event.currentTarget, event.offsetX);
                mouseisdown = true;
                movethumb(event.offsetX);
            }
            function mouseup(event) {
                console.log(event.type, event.target === event.currentTarget);
                mouseisdown = false;
            }
            function mousemove(event) {
                if (mouseisdown) {
                    console.log(event.type, event.target === event.currentTarget, event.offsetX);
                    movethumb(event.offsetX);
                }
            }
            function mouseleave(event) {
                console.log(event.type, event.target === event.currentTarget);
                mouseisdown = false;
            }
            let mouseisdown = false;
            $('.slider').mousedown(mousedown);
            $('body').mouseup(mouseup);
            $('body').mouseleave(mouseup);
            $('.slider').mousemove(mousemove);
            // $('.slider').mouseleave(mouseleave);
            movethumb(0);
        </script>
    </body>
</html>
